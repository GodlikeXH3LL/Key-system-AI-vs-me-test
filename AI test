
-- Load the Orion library securely
local function loadOrionLib()
    local success, lib = pcall(function()
        return loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Orion/main/source'))()
    end)
    if success then
        return lib
    else
        warn("Failed to load Orion library.")
        return nil
    end
end

local OrionLib = loadOrionLib()
if not OrionLib then return end

local OrionWindow = OrionLib:MakeWindow({ Name = "OLD KTM NIGGER SOR", SaveConfig = true, ConfigFolder = "MLR HUB V1" })

-- Create Tabs
local Tabs = {
    Home = OrionWindow:MakeTab({ Name = "HOME" }),
    Teleports = OrionWindow:MakeTab({ Name = "Teleports" }),
    Farming = OrionWindow:MakeTab({ Name = "Farming" }),
    Misc = OrionWindow:MakeTab({ Name = "Misc" })
}

-- Anti-Lag Feature
local isAntiLagEnabled = false
local function setAntiLag(value)
    isAntiLagEnabled = value
    if isAntiLagEnabled then
        notify("Anti-Lag Enabled", "The script will now have reduced lag.", 3)
    else
        notify("Anti-Lag Disabled", "The script will return to normal performance.", 3)
    end
end

-- Helper function to adjust wait time based on anti-lag setting
local function getWaitTime()
    return isAntiLagEnabled and 0.1 or 0.005
end

Tabs.Home:AddButton({
    Name = "Buffze",
    Callback = function()
     end
})

Tabs.Home:AddButton({
    Name = "this script is very new dont expect it to be the best!",
    Callback = function()
        notify("Enjoy!", 5)
    end
})

-- Discord Invite Button
Tabs.Home:AddButton({
    Name = "J",
    Callback = function()
        notify("Discord Invite", "Copy and Paste the server link into Google!", 5)
    end
})

-- Home Tab Buttons
Tabs.Home:AddButton({
    Name = "Inf Yield",
    Callback = function()
        local success, err = pcall(function()
            loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
        end)
        if not success then
            notify("Error", "Failed to load Inf Yield.", 5)
        end
    end
})

-- Teleports Tab Buttons
local TeleportLocations = {
    ["Muscle King Gym"] = Vector3.new(-8936, 17, -5926),
    ["Legends Gym"] = Vector3.new(4342, 1001, -3758),
    ["Infernal Gym"] = Vector3.new(-6946, 17, -1204),
    ["Mythical Gym"] = Vector3.new(2379, 17, 1065),
    ["Frost Gym"] = Vector3.new(-2719, 17, -397),
    ["Tiny Island"] = Vector3.new(-24, 18, 1940),
    ["Spawn Island"] = Vector3.new(-20.808530807495117, 7.3037309646606445, -108.02957916259766)
}

for gymName, position in pairs(TeleportLocations) do
    Tabs.Teleports:AddButton({
        Name = gymName,
        Callback = function()
            local player = game.Players.LocalPlayer
            if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.CFrame = CFrame.new(position)
            end
        end
    })
end

-- Helper function to equip the "Punch" tool
local function equipTool(toolName)
    local player = game.Players.LocalPlayer
    local backpack = player:FindFirstChild("Backpack")
    if backpack then
        local tool = backpack:FindFirstChild(toolName)
        if tool then
            player.Character.Humanoid:EquipTool(tool)
            notify("Tool Equipped", "Equipped the " .. toolName .. " tool.", 3)
        else
            notify("Error", toolName .. " tool not found in backpack.", 5)
        end
    else
        notify("Error", "Backpack not found.", 5)
    end
end

-- Add Auto Durability Toggle Button
local Settings = { WorkOut1 = false, Rebirth = false, MaxRebirths = 0 }
local RocksPosition = Vector3.new(-9041.447265625, 9.123734474182129, -6059.32080078125) -- Replace with the exact coordinates of the King Rock
local lockedPosition = CFrame.new(-9035.16015625, 5.496868133544922, -6046.73876953125) -- Position the player slightly in front of the rock for punching

Tabs.Farming:AddToggle({
    Name = "Hit king rock (BETA)",
    Callback = function(State)
        Settings.WorkOut1 = State
        game:GetService("RunService").Stepped:Connect(function()
            if Settings.WorkOut1 then
                pcall(function()
                    game.Players.LocalPlayer.Character.Humanoid:ChangeState(11)
                end)
            end
        end)

        spawn(function()
            while Settings.WorkOut1 do
                wait(0.1) -- Slight delay between actions to avoid overloading
                pcall(function()
                    -- Lock the player to a position slightly in front of the rock
                    game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = lockedPosition

                    -- Ensure the player is facing the rock
                    local humanoidRootPart = game.Players.LocalPlayer.Character.HumanoidRootPart
                    humanoidRootPart.CFrame = CFrame.new(humanoidRootPart.Position, RocksPosition)

                    -- Ensure the player equips the punch tool
                    local player = game.Players.LocalPlayer
                    local backpack = player:FindFirstChild("Backpack")
                    if backpack then
                        local punchTool = backpack:FindFirstChild("Punch")
                        if punchTool then
                            player.Character.Humanoid:EquipTool(punchTool)
                        else
                        end
                    else
                    end

                    -- Fire the punch event to interact with the King Rock
                    game:GetService("Players").LocalPlayer.muscleEvent:FireServer("punch", "leftHand")
                    game:GetService("Players").LocalPlayer.muscleEvent:FireServer("punch", "rightHand")
                end)
            end
        end)
    end
})

-- Lock/Unlock Position Toggle with Auto-Teleport and Re-lock on Death or Rebirth
local isPositionLocked = false
local initialCFrame = nil
local lockPositionLoop = nil

-- Function to start the position lock loop
local function startLockPositionLoop()
    while isPositionLocked do
        if initialCFrame then
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = initialCFrame
        end
        wait(0.1)
    end
end

-- Lock/Unlock Position Toggle
Tabs.Farming:AddToggle({
    Name = "Lock Client Position (BETA)",
    Callback = function(State)
        local player = game.Players.LocalPlayer
        local character = player.Character or player.CharacterAdded:Wait()
        local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

        if State then
            if isPositionLocked then
                notify("Already Locked", "Your position is already locked.", 3)
                return
            end

            -- Lock position
            initialCFrame = humanoidRootPart.CFrame
            isPositionLocked = true
            if not lockPositionLoop then
                lockPositionLoop = spawn(startLockPositionLoop)
            end
            notify("Position Locked", "Your position is now locked.", 3)

            -- Automatically re-lock the position upon death or rebirth
            player.CharacterAdded:Connect(function(character)
                local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
                wait(1) -- Small delay to ensure the character is fully loaded

                -- Teleport back to the locked position
                humanoidRootPart.CFrame = initialCFrame
            end)
        else
            isPositionLocked = false
            initialCFrame = nil
            notify("Position Unlocked", "You are free to move.", 3)
        end
    end
})

-- Auto Rebirth Feature with Target Rebirth Input
local function getRebirthCount()
    return game:GetService("Players").LocalPlayer.leaderstats.Rebirths.Value
end

local function autoRebirthLoop()
    while Settings.Rebirth do
        wait(0.1)
        local currentRebirths = getRebirthCount()

        if currentRebirths >= Settings.MaxRebirths then
            Settings.Rebirth = false
            notify("Auto Rebirth", "Target rebirths reached. Auto Rebirth turned off.", 5)
            break
        end

        -- Rebirth logic
        game:GetService("ReplicatedStorage").rEvents.rebirthRemote:InvokeServer("rebirthRequest")
    end
end

Tabs.Farming:AddToggle({
    Name = "Auto Join Brawl (BETA)",
    Default = false,
    Callback = function(State)
        Settings.Hot = State
        if Settings.Hot then
            -- Define the Auto Join Brawl functionality
            spawn(function()
                while Settings.Hot do
                    wait(1)  -- Adjust the delay as needed
                    pcall(function()
                        local brawlEvent = game:GetService("ReplicatedStorage").rEvents.brawlEvent
                        if brawlEvent then
                            brawlEvent:FireServer("joinBrawl")
                        else
                            warn("Brawl Event not found")
                        end
                    end)
                end
            end)
            notify("Auto Join Brawl Enabled", "Automatically joining brawls every 1 second.", 3)
        else
            notify("Auto Join Brawl Disabled", "Stopped automatically joining brawls.", 3)
        end
    end
})

Tabs.Farming:AddToggle({
    Name = "Auto Rebirth (BETA)",
    Callback = function(State)
        Settings.Rebirth = State
        if Settings.Rebirth then
            spawn(autoRebirthLoop)
        end
    end
})

Tabs.Farming:AddTextbox({
    Name = "Rebriths Stopping point",
    Default = "0",
    TextDisappear = true,
    Callback = function(value)
        local targetRebirths = tonumber(value)
        if targetRebirths then
            Settings.MaxRebirths = targetRebirths
            notify("Target Rebirths Set", "Target rebirths set to " .. targetRebirths, 3)
        else
            notify("Invalid Input", "Please enter a valid number.", 3)
        end
    end
})


-- Anti-Lag Feature
local isAntiLagEnabled = false

local function setAntiLag(value)
    isAntiLagEnabled = value
    if isAntiLagEnabled then
        notify("Anti-Lag Enabled", "The script will now have reduced lag.", 3)
    else
        notify("Anti-Lag Disabled", "The script will return to normal performance.", 3)
    end
end

local function applyAntiLag()
    if isAntiLagEnabled then
        local decalsyeeted = true
        local gameService = game
        local workspace = gameService.Workspace
        local lighting = gameService.Lighting
        local terrain = workspace.Terrain
        
        -- Optimize Terrain
        terrain.WaterWaveSize = 0
        terrain.WaterWaveSpeed = 0
        terrain.WaterReflectance = 0
        terrain.WaterTransparency = 0
        
        -- Optimize Lighting
        lighting.GlobalShadows = false
        lighting.FogEnd = 9e9
        lighting.Brightness = 0
        settings().Rendering.QualityLevel = "Level01"
        
        -- Iterate through all descendants
        for _, v in pairs(gameService:GetDescendants()) do
            if v:IsA("Part") or v:IsA("Union") or v:IsA("CornerWedgePart") or v:IsA("TrussPart") then
                v.Material = "Plastic"
                v.Reflectance = 0
            elseif (v:IsA("Decal") or v:IsA("Texture")) and decalsyeeted then
                v.Transparency = 1
            elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
                v.Lifetime = NumberRange.new(0)
            elseif v:IsA("Explosion") then
                v.BlastPressure = 1
                v.BlastRadius = 1
            elseif v:IsA("Fire") or v:IsA("SpotLight") or v:IsA("Smoke") then
                v.Enabled = false
            elseif v:IsA("MeshPart") then
                v.Material = "Plastic"
                v.Reflectance = 0
                v.TextureID = 10385902758728957
            end
        end
        
        -- Iterate through all lighting effects
        for _, e in pairs(lighting:GetChildren()) do
            if e:IsA("BlurEffect") or e:IsA("SunRaysEffect") or e:IsA("ColorCorrectionEffect") or e:IsA("BloomEffect") or e:IsA("DepthOfFieldEffect") then
                e.Enabled = false
            end
        end
    end
end

-- Add Anti-Lag Toggle
Tabs.Misc:AddButton({
    Name = "Anti Lag V2",
    Callback = function(state)
        setAntiLag(state)
        applyAntiLag()
    end
})

OrionLib:Init()
